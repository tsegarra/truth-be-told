<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125915500-2"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125915500-2');
  if (window.location.hostname == 'tbt.test') {
    window['ga-disable-UA-125915500-2'] = true;
  }

  function captureOutboundLink(url) {
    gtag('event', 'click', {
      'event_category': 'Outbound link',
      'event_label': url,
    });
  }
  </script>
  <title>Truth Be Told</title>
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <meta name="description" content="Truth Be Told is a party game where players answer a series of questions while pretending to be each other." />
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#9f00a7">
  <meta name="theme-color" content="#ffffff">
</head>

<body></body>

<template name="main">
  {{> inGameHeader }}

  <div class="main-content gutter">
    {{> Template.dynamic template=whichView}}
  </div>
</template>

<template name="startMenu">
  <div class="button-container center">
    <p class="intro-text">Win points by impersonating your friends while answering a series of questions.</p>
    <button class="btn-contained" id="btn-new-game">New Game</button>
    <button class="btn-contained" id="btn-join-game">Join Game</button>
  </div>

  <footer class="homepage-footer">
    <p><a target="_blank" onclick="captureOutboundLink('https://boardgamegeek.com/boardgame/58707/truth-be-told')" href="https://boardgamegeek.com/boardgame/58707/truth-be-told">Truth Be Told</a> is published by <a onclick="captureOutboundLink('https://buffalogames.com/')" target="_blank" href="https://buffalogames.com/">Buffalo Games</a>.</p>
    <p>This unauthorized adaptation is <a target="_blank" onclick="captureOutboundLink('https://github.com/tsegarra/truth-be-told')" href="https://github.com/tsegarra/truth-be-told">hosted on GitHub</a>.</p>
  </footer>
</template>

<template name="createGame">
  {{#if isLoading }}
    <h4><span class="spinner">Loading...</span></h4>
  {{/if}}

  <form class="center" id="create-game">
    <input type="text" id="player-name" name="playerName" autocomplete="off" placeholder="Enter your name" />
    <div class="button-container">
      <input class="btn-contained" type="submit" value="Create game" />
      <button class="btn-back btn-outlined">Back</button>
    </div>
  </form>
</template>

<template name="joinGame">
  {{#if isLoading }}
    <h4><span class="spinner">Loading...</span></h4>
  {{/if}}

  {{#if playerExists}}
    <div class="details-container">
        <p>A player with this name already exists. If you join the game, you'll be logged in as that player.</p>
    </div>
  {{/if}}
  <form id="join-game" class="center">
    <input autocomplete="off" type="text" id="access-code" name="accessCode" placeholder="Enter an access code" />
    <input type="text" id="player-name" name="playerName" autocomplete="off" placeholder="Enter your name" />

    <div class="button-container">
      <input class="btn-contained" type="submit" value="Join" />
      <button class="btn-back btn-outlined">Back</button>
    </div>
  </form>
</template>

<template name="lobby">
  {{#if isLoading }}
    <h4><span class="spinner">Loading...</span></h4>
  {{/if}}

  <div class="access-code-container">
    <label class="access-code-label">Access code</label>
    <span class="access-code">{{ game.accessCode }}</span>
  </div>

  <ol class="lobby-player-list">
    <li class="header-row">
      <span class="name">Players</span>
    </li>
    {{#each players}}
      <li>
        <span class="name">{{ name }}</span>
        {{#if isCurrent }}
          <a href="#" class="btn-edit-player" data-player-id="{{_id}}">
            <i class="material-icons md-18 orange">settings</i>
          </a>
        {{else}}
          <a href="#" class="btn-remove-player" data-player-id="{{_id}}">
            <i class="material-icons md-18 orange">delete</i>
          </a>
        {{/if}}
      </li>
    {{/each}}
  </ol>

  <div class="button-container">
    <button class="btn-contained btn-start">Start game</button>
    <button class="btn-outlined btn-leave">Leave game</button>
  </div>
</template>

<template name="gameView">
  <div class="instruction-container">
    {{#if player.duplicate }}
      <p class="duplicate-message">Your answer is a duplicate and was returned to you by {{ game.turn }}.</p>
    {{/if}}

    {{#unless player.answer}}
      <p class="player-status">
        Write an answer that applies to
          {{#if player.isTurn}}yourself{{else}}{{ game.turn }}{{/if}}
      </p>
    {{/unless}}
  </div><!-- /.instruction-container -->

  <div class="gameplay-container">
    {{#if player.answer }}
      <p class="card"><span class="card-text">{{ game.card }}</span><a href="#" class="btn-change-answer"><i class="material-icons md-24 orange">edit</i></a></p>
      <span class="submitted-answer">{{ player.answer }}</span>
      <script>
        var cardText = $('.card-text').text();
        var indexOfBlank = cardText.indexOf('___');
        $('.card-text').text('');
        $('<span>').text(cardText.substring(0, indexOfBlank)).appendTo('.card-text');
        $('.submitted-answer').appendTo('.card-text');
        $('<span>').text(cardText.substring(indexOfBlank + 3)).appendTo('.card-text');
      </script>
    {{ else }}
      <form id="card-form">
        <p class="card-text">{{ game.card }}</p>
        <input type="text" id="answer" name="answer" autocomplete="off" value={{player.previousAnswer}} />
        <input class="btn-contained card-submit" type="submit" value="Submit" />
      </form>
      <script>
        var showHideSubmit = function() {
          var text = $('#answer').val();
          if (text) {
            $('.card-submit').show();
            $('.card-blank').text(text);
          } else {
            $('.card-submit').hide();
            $('.card-blank').text('___');
          }
        };

        showHideSubmit();

        var cardText = $('.card-text').text();
        var indexOfBlank = cardText.indexOf('___');
        $('.card-text').text('');
        $('<span>').text(cardText.substring(0, indexOfBlank)).appendTo('.card-text');
        var currentAnswer = $('#answer').val();
        var blankText = currentAnswer ? currentAnswer : '___';
        $('<span>').addClass('card-blank').text(blankText).appendTo('.card-text');
        $('<span>').text(cardText.substring(indexOfBlank + 3)).appendTo('.card-text');
        $('#answer').focus();

        $('#answer').keyup(function() {
          showHideSubmit();
        });
      </script>
    {{/if}}
  </div><!-- /.gameplay-container -->

  <div class="details-container">
    <p>Waiting for:</p>
    <ul class="players">
      {{#each players}}
        {{#unless this.answer }}
          {{# if this.isCurrent }}
            <li>You</li>
          {{ else }}
            <li>{{ this.name }}</li>
          {{/if}}
        {{/unless}}
      {{/each}}
    </ul>
  </div><!-- /.details-container -->

  <footer>Access code: {{ game.accessCode }}</footer>
</template>

<template name="reviewView">
  {{#if player.isTurn}}
    <div class="instruction-container">
      <p>Review the answers below. If there are any duplicates, select all but one to be revised before continuing.</p>
    </div><!-- /.instruction-container -->

    <div class="gameplay-container">
      <form id="review-answers">
        {{#each players}}
          <div class="answer-checkboxes">
            {{#if this.isTurn}}
              <input type="checkbox" id="answer-{{this._id}}" name="{{this._id}}" disabled="disabled" /><label for="{{this._id}}"><strong>{{this.answer}}</strong></label>
            {{else}}
              <input type="checkbox" id="answer-{{this._id}}" name="{{this._id}}" /><label for="{{this._id}}"><strong>{{this.answer}}</strong> &mdash; {{this.name}}</label>
            {{/if}}
          </div>
        {{/each}}
        <input class="btn-contained" type="submit" value="Continue" />
      </form>
    </div><!-- /.gameplay-container-->
  {{else}}
    <div class="instruction-container">
      <p>Answers are under review.</p>
    </div>
  {{/if}}
  <footer>Access code: {{ game.accessCode }}</footer>
</template>

<template name="voteView">
  {{#if isLoading }}
    <h4><span class="spinner">Loading...</span></h4>
  {{/if}}

  {{#if player.isTurn }}
    {{#unless game.cardsBeenRead}}
      <p>Read the cards aloud to the group, then click Continue.</p>
    {{/unless}}

    <div class="gameplay-container">
      <p>{{ game.card }}</p>
      <ul class="player-answers">
        {{#each game.randomPlayers}}
          <li><strong>{{ this.answer }}</strong> &mdash; {{ this.name }}</li>
        {{/each}}
      </ul>
    </div><!-- /.gameplay-container -->

    <div class="details-container">
      {{#if game.cardsBeenRead}}
        <p>Waiting for votes to be cast by:</p>
        <ul>
          {{#each players}}
            {{#unless this.vote}}
              {{#unless this.isTurn}}
                <li>{{ this.name }}</li>
              {{/unless}}
            {{/unless}}
          {{/each}}
        </ul>
      {{else}}
        <a href="#" class="btn-show-cards btn-contained">Continue</a>
      {{/if}}
    </div><!-- /.details-container -->
  {{else}}
    {{#if game.cardsBeenRead}}
      <p>Click the card you think belongs to {{ game.turn }}.</p>

      <div class="gameplay-container">
        <p>{{ game.card }}</p>
        <ul class="vote-buttons">
          {{#each game.randomPlayers}}
            <li>
              {{#if equals this._id player._id}}
                {{ this.answer }}
              {{else}}
                <a href="#" class="btn-vote" data-id="{{this._id}}">{{ this.answer }}</a>
                {{#if equals this._id player.vote._id }}<i class="material-icons md-18 green">check_circle</i>{{/if}}
              {{/if}}
            </li>
          {{/each}}
        </ul>
      </div><!--/.gameplay-container -->
    {{else}}
      <p>Waiting for cards to be read aloud.</p>
    {{/if}}
  {{/if}}
  <footer>Access code: {{ game.accessCode }}</footer>
</template>

<template name="resultsView">
  <p>Round complete.</p>

  <div class="gameplay-container">
    <p>{{game.card}}</p>
    <ul>
      {{#each players}}
        {{#if this.isTurn}}
          <li class="correct-answer"><strong>{{ this.answer }}</strong> &mdash; {{this.name}}</li>
        {{else}}
          <li><strong>{{ this.answer }}</strong> &mdash; {{this.name}}</li>
        {{/if}}
      {{/each}}
    </ul>
  </div><!-- /.gameplay-container -->

  <div class="details-container">
    {{#each players}}
      {{#unless this.isTurn}}
        <div class="answer-line">
          <p>{{ this.name }} picked {{ this.vote.name }}'s answer</p>
          <ul>
            <li>+1 for {{ this.vote.name }}</li>
            {{#if this.vote.isTurn}}<li>+1 for {{this.name}}</li>{{/if}}
          </ul>
        </div>
      {{/unless}}
    {{/each}}

    <div class="scores-container">
      <h3 class="scores-heading">Scores</h3>
      <table>
        {{#each scores}}
          <tr>
            <td>{{ this.name }}</td>
            <td>
              {{#each score in this.scores }}
                {{#if score}}
                  <span class="point has-point">1</span>
                {{else}}
                  <span class="point">0</span>
                {{/if}}
              {{/each}}
            </td>
          </tr>
        {{/each}}
      </table>
    </div><!-- /.scores-container -->
  </div><!-- /.details-container -->

  {{# if winningMessage }}
    <p>{{winningMessage}}</p>
    <a href="#" class="btn-contained btn-new-game">New game</a>
  {{else}}
    {{# if player.isTurn }}
      <a href="#" class="btn-contained btn-next-round">Next</a>
    {{/if}}
  {{/if}}

  <footer>Access code: {{ game.accessCode }}</footer>
</template>

<template name="inGameHeader">
  <header>
    <div class="gutter">
      <h5>Truth Be Told</h5>
    </div>
  </header>
</template>
