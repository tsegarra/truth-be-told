<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125915500-2"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-125915500-2');
  </script>
  <title>Truth Be Told</title>
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css?family=Hammersmith+One&display=swap" rel="stylesheet">
</head>

<body></body>

<template name="main">
  <div class="main-content">
    {{> Template.dynamic template=whichView}}
  </div>
</template>

<template name="startMenu">
  <h4>Truth Be Told</h4>

  <div class="button-container">
    <button id="btn-new-game">New Game</button>
    <button id="btn-join-game">Join Game</button>
  </div>
</template>

<template name="createGame">
  <h4>
    {{#if isLoading }}
      <span class="spinner">Loading...</span>
    {{else}}
      Truth Be Told
    {{/if}}
  </h4>

  <form id="create-game">
    <input type="text" id="player-name" name="playerName" autocomplete="off" placeholder="Enter your name" />
    <div class="button-container">
      <input type="submit" value="Create game" />
      <button class="btn-back">Back</button>
    </div>
  </form>
</template>

<template name="joinGame">
  <h4>
    {{#if isLoading }}
      <span class="spinner">Loading...</span>
    {{else}}
      Truth Be Told
    {{/if}}
  </h4>
  <hr />

  <div class="body-container">
    {{#if playerExists}}
      <div class="details-container">
          <p>A player with this name already exists. If you join the game, you'll be logged in as that player.</p>
      </div>
    {{/if}}
    <form id="join-game">
      <input autocomplete="off" type="text" id="access-code" name="accessCode" placeholder="Enter an access code" />
      <input type="text" id="player-name" name="playerName" autocomplete="off" placeholder="Enter your name" />

      <div class="button-container">
        <input type="submit" value="Join" />
        <button class="btn-back">Back</button>
      </div>
    </form>
  </div>
</template>

<template name="lobby">
  <h4>
    {{#if isLoading }}
      <span class="spinner">Loading...</span>
    {{else}}
      Truth Be Told
    {{/if}}
  </h4>

  <div class="access-code">
    Access code: <span>{{ game.accessCode }}</span>
  </div>

  <ol class="lobby-player-list">
    {{#each players}}
      <li>
        {{ name }}

        {{#if isCurrent }}
          <a href="#" class="btn-edit-player" data-player-id="{{_id}}">
            <i class="fa fa-pencil">Edit</i>
          </a>
        {{else}}
          <a href="#" class="btn-remove-player" data-player-id="{{_id}}">
            <i class="fa fa-close">&times;</i>
          </a>
        {{/if}}
      </li>
    {{/each}}
  </ol>

  <div class="button-container">
    <button class="btn-start">Start game</button>
    <button class="btn-leave">Leave game</button>
  </div>
</template>

<template name="gameView">
  {{> inGameHeader }}

  <div class="body-container">
    <div class="instruction-container">
      {{#if player.duplicate }}
        <p class="duplicate-message">Your answer is a duplicate and was returned to you by {{ game.turn }}.</p>
      {{/if}}

      {{#unless player.answer}}
        <p class="player-status">
          {{#if player.isTurn}}
            Write an answer for yourself.
          {{else}}
            Write an answer that applies to {{ game.turn }}.
          {{/if}}
        </p>
      {{/unless}}
    </div><!-- /.instruction-container -->

    <div class="gameplay-container">
      {{#if player.answer }}
        <p class="card">{{ game.card }}</p>
        <p><strong>{{ player.answer }}</strong> <a href="#" class="btn-change-answer">Edit</a></p>
      {{ else }}
        <form id="card-form">
          <p class="card-text">{{ game.card }}</p>
          <input type="text" id="answer" name="answer" autocomplete="off" value={{player.previousAnswer}} />
          <input type="submit" value="Submit" />
        </form>
      {{/if}}
    </div><!-- /.gameplay-container -->

    <div class="details-container">
      <p>Waiting for:</p>
      <ul class="players">
        {{#each players}}
          {{#unless this.answer }}
            {{# if this.isCurrent }}
              <li>You</li>
            {{ else }}
              <li>{{ this.name }}</li>
            {{/if}}
          {{/unless}}
        {{/each}}
      </ul>
    </div><!-- /.details-container -->
  </div><!-- /.body-container -->

  <footer>Access code: {{ game.accessCode }}</footer>
</template>

<template name="reviewView">
  {{> inGameHeader }}

  <div class="body-container">
    {{#if player.isTurn}}
      <div class="instruction-container">
        <p>Review the answers below. If there are any duplicates, select all but one to be revised before continuing.</p>
      </div><!-- /.instruction-container -->

      <div class="gameplay-container">
        <form id="review-answers">
          {{#each players}}
            <div class="answer-checkboxes">
              {{#if this.isTurn}}
                <input type="checkbox" id="answer-{{this._id}}" name="{{this._id}}" disabled="disabled" /><label for="{{this._id}}"><strong>{{this.answer}}</strong></label>
              {{else}}
                <input type="checkbox" id="answer-{{this._id}}" name="{{this._id}}" /><label for="{{this._id}}"><strong>{{this.answer}}</strong> &mdash; {{this.name}}</label>
              {{/if}}
            </div>
          {{/each}}
          <input type="submit" value="Continue" />
        </form>
      </div><!-- /.gameplay-container-->
    {{else}}
      <div class="instruction-container">
        <p>Answers are under review.</p>
      </div>
    {{/if}}
  </div><!-- /.body-container -->
  <footer>Access code: {{ game.accessCode }}</footer>
</template>

<template name="voteView">
  {{> inGameHeader }}

  <div class="body-container">
    {{#if isLoading }}
      <h4><span class="spinner">Loading...</span></h4>
    {{/if}}

    {{#if player.isTurn }}
      {{#unless game.cardsBeenRead}}
        <p>Read the cards aloud to the group, then click Continue.</p>
      {{/unless}}

      <div class="gameplay-container">
        <p>{{ game.card }}</p>
        <ul class="player-answers">
          {{#each game.randomPlayers}}
            <li><strong>{{ this.answer }}</strong> &mdash; {{ this.name }}</li>
          {{/each}}
        </ul>
      </div><!-- /.gameplay-container -->

      <div class="details-container">
        {{#if game.cardsBeenRead}}
          <p>Waiting for votes to be cast by:</p>
          <ul>
            {{#each players}}
              {{#unless this.vote}}
                {{#unless this.isTurn}}
                  <li>{{ this.name }}</li>
                {{/unless}}
              {{/unless}}
            {{/each}}
          </ul>
        {{else}}
          <a href="#" class="btn-show-cards">Continue</a>
        {{/if}}
      </div><!-- /.details-container -->
    {{else}}
      {{#if game.cardsBeenRead}}
        <p>Click the card you think belongs to {{ game.turn }}.</p>

        <div class="gameplay-container">
          <p>{{ game.card }}</p>
          <ul class="vote-buttons">
            {{#each game.randomPlayers}}
              <li>
                {{#if equals this._id player._id}}
                  {{ this.answer }}
                {{else}}
                  <a href="#" class="btn-vote" data-id="{{this._id}}">{{ this.answer }}</a>
                  {{#if equals this._id player.vote._id }}<strong>voted</strong>{{/if}}
                {{/if}}
              </li>
            {{/each}}
          </ul>
        </div><!--/.gameplay-container -->
      {{else}}
        <p>Waiting for cards to be read aloud.</p>
      {{/if}}
    {{/if}}
  </div><!-- /.body-container -->
  <footer>Access code: {{ game.accessCode }}</footer>
</template>

<template name="resultsView">
  {{> inGameHeader }}

  <div class="body-container">
    <p>Round complete.</p>

    <div class="gameplay-container">
      <p>{{game.card}}</p>
      <ul>
        {{#each players}}
          {{#if this.isTurn}}
            <li class="correct-answer"><strong>{{ this.answer }}</strong> &mdash; {{this.name}}</li>
          {{else}}
            <li><strong>{{ this.answer }}</strong> &mdash; {{this.name}}</li>
          {{/if}}
        {{/each}}
      </ul>
    </div><!-- /.gameplay-container -->

    <div class="details-container">
      {{#each players}}
        {{#unless this.isTurn}}
          <p>
            {{ this.name }} picked {{ this.vote.name }}'s answer.
            (+1 for {{ this.vote.name }})
            {{#if this.vote.isTurn}}(+1 for {{this.name}}){{/if}}
          </p>
        {{/unless}}
      {{/each}}

      <div class="scores-container">
        <h3 class="scores-heading">Scores</h3>
        <table>
          {{#each scores}}
            <tr>
              <td>{{ this.name }}</td>
              <td>
                {{#each score in this.scores }}
                  {{#if score}}
                    <span class="point has-point">1</span>
                  {{else}}
                    <span class="point">0</span>
                  {{/if}}
                {{/each}}
              </td>
            </tr>
          {{/each}}
        </table>
      </div><!-- /.scores-container -->
    </div><!-- /.details-container -->

    {{# if winningMessage }}
      <p>{{winningMessage}}</p>
      <a href="#" class="btn-new-game">New game</a>
    {{else}}
      {{# if player.isTurn }}
        <a href="#" class="btn-next-round">Next</a>
      {{/if}}
    {{/if}}
  </div><!-- /.body-container -->
  <footer>Access code: {{ game.accessCode }}</footer>
</template>

<template name="inGameHeader">
  <header>
    <h5>Truth Be Told</h5>
  </header>
</template>
