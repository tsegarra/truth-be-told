<head>
  <title>Truth Be Told</title>
</head>

<body></body>

<template name="main">
  <div class="main-content">
    {{> Template.dynamic template=whichView}}
  </div>
</template>

<template name="startMenu">
  <h4>Truth Be Told</h4>

  <div class="button-container">
    <button id="btn-new-game">New Game</button>
    <button id="btn-join-game">Join Game</button>
  </div>
</template>

<template name="createGame">
  <h4>
    {{#if isLoading }}
      <span class="spinner">Loading...</span>
    {{else}}
      Truth Be Told
    {{/if}}
  </h4>

  <form id="create-game">
    <input type="text" id="player-name" name="playerName" autocomplete="off" placeholder="Enter your name" />
    <div class="button-container">
      <input type="submit" value="Create game" />
      <button class="btn-back">Back</button>
    </div>
  </form>
</template>

<template name="joinGame">
  <h4>
    {{#if isLoading }}
      <span class="spinner">Loading...</span>
    {{else}}
      Truth Be Told
    {{/if}}
  </h4>
  <hr />

  <form id="join-game">
    <input autocomplete="off" type="text" id="access-code" name="accessCode" placeholder="Enter an access code" />
    <input type="text" id="player-name" name="playerName" autocomplete="off" placeholder="Enter your name" />

    <div class="button-container">
      <input type="submit" value="Join" />
      <button class="btn-back">Back</button>
    </div>
  </form>
</template>

<template name="lobby">
  <h4>
    {{#if isLoading }}
      <span class="spinner">Loading...</span>
    {{else}}
      Truth Be Told
    {{/if}}
  </h4>

  <div class="access-code">
    Access code: <span>{{ game.accessCode }}</span>
  </div>

  <hr />

  <ol class="lobby-player-list">
    {{#each players}}
      <li>
        {{ name }}

        {{#if isCurrent }}
          <a href="#" class="btn-edit-player" data-player-id="{{_id}}">
            <i class="fa fa-pencil">Edit</i>
          </a>
        {{else}}
          <a href="#" class="btn-remove-player" data-player-id="{{_id}}">
            <i class="fa fa-close">&times;</i>
          </a>
        {{/if}}
      </li>
    {{/each}}
  </ol>

  <hr />

  <div class="button-container">
    <button class="btn-start">Start game</button>
    <button class="btn-leave">Leave game</button>
  </div>
</template>

<template name="gameView">
  {{#if player.duplicate }}
    <h3>Your answer was a duplicate. Choose another.</h3>
  {{/if}}

  {{#if player.answer }}
    <p class="card">{{ game.card }}</p>
    <p><strong>{{ player.answer }} (Answer for {{ game.turn }})</strong></p>
    <a href="#" class="btn-change-answer">Edit</a>
  {{ else }}
    <h3 class="player-status">
      {{#if player.isTurn}}
        Write an answer for yourself.
      {{else}}
        Write an answer that applies to {{ game.turn }}.
      {{/if}}
    </h3>

    <form id="card-form">
      <p class="card-text">{{ game.card }}</p>
      <input type="text" id="answer" name="answer" autocomplete="off" value={{player.previousAnswer}} />
      <input type="submit" value="Done" />
    </form>
  {{/if}}

  <h3>Waiting for:</h3>
  <ul class="players">
    {{#each players}}
      {{#unless this.answer }}
        {{# if this.isCurrent }}
          <li>You</li>
        {{ else }}
          <li>{{ this.name }}</li>
        {{/if}}
      {{/unless}}
    {{/each}}
  </ul>
</template>

<template name="voteView">
  {{#if isLoading }}
    <h4><span class="spinner">Loading...</span></h4>
  {{/if}}

  {{#if player.isTurn }}
    <h3>It is your turn. Here are the cards. Read them to yourself before reading them aloud.</h3>
    <p><strong>{{ game.card }}</strong></p>
    <ul>
      {{#each game.randomPlayers}}
        <li><strong>{{ this.name }}</strong>: {{ this.answer }}</li>
      {{/each}}
    </ul>
    {{#if game.cardsBeenRead}}
      <h3>Waiting for votes to be cast by:</h3>
      <ul>
        {{#each players}}
          {{#unless this.vote}}
            {{#unless this.isTurn}}
              <li>{{ this.name }}</li>
            {{/unless}}
          {{/unless}}
        {{/each}}
      </ul>
    {{else}}
      <a href="#" class="btn-show-cards">The cards have all been read</a>
    {{/if}}
  {{else}}
    {{#if game.cardsBeenRead}}
      <h3>Click the card you think belongs to {{ game.turn }}.</h3>
      <p>{{ game.card }}</p>
      <ul>
        {{#each game.randomPlayers}}
          <li>
            {{#if equals this._id player._id}}
              {{ this.answer }}
            {{else}}
              <a href="#" class="btn-vote" data-id="{{this._id}}">{{ this.answer }}</a>
              {{#if equals this._id player.vote._id }}<strong>voted</strong>{{/if}}
            {{/if}}
          </li>
        {{/each}}
      </ul>
    {{else}}
      <h3>Waiting for cards to be read aloud.</h3>
    {{/if}}
  {{/if}}
</template>

<template name="resultsView">
  {{#if player.isTurn }}
    <h1>Round complete.</h1>
    <p>{{game.card}}</p>
    {{#each players}}
      {{#if this.isTurn }}
        <h2>{{this.name}}: {{this.answer}}</h2>
      {{/if}}
    {{/each}}
    <ul>
      {{#each players}}
        {{#unless this.isTurn}}
          <li>{{ this.name }}: {{this.answer}}</li>
        {{/unless}}
      {{/each}}
    </ul>
    <ul>
      {{#each players}}
        {{#unless this.isTurn}}
          <li>
            {{ this.name }} picked {{ this.vote.name }}'s answer.
            (+1 for {{ this.vote.name }})
            {{#if this.vote.isTurn}}(+1 for {{this.name}}){{/if}}
          </li>
        {{/unless}}
      {{/each}}
    </ul>
    <ul>
      {{#each players}}
        <li>{{ this.name }} &mdash; {{ this.score }}</li>
      {{/each}}
    </ul>
    {{# if winningMessage }}
      <h1>{{winningMessage}}</h1>
      <a href="#" class="btn-new-game">New game</a>
    {{else}}
      <a href="#" class="btn-next-round">Next</a>
    {{/if}}
  {{else}}
    {{#if winningMessage }}
      <h1>Game complete! {{winningMessage}}</h1>
    {{else}}
      <h1>Round complete! Waiting for {{ game.turn }} to read the results.</h1>
    {{/if}}
  {{/if}}
</template>
